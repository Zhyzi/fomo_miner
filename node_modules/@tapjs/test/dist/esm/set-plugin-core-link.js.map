{"version":3,"file":"set-plugin-core-link.js","sourceRoot":"","sources":["../../src/set-plugin-core-link.ts"],"names":[],"mappings":"AAAA;;GAEG;AAEH,OAAO,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,IAAI,CAAA;AAC9C,OAAO,EAAE,UAAU,EAAE,MAAM,QAAQ,CAAA;AACnC,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,MAAM,CAAA;AACvC,OAAO,EAAE,UAAU,EAAE,MAAM,QAAQ,CAAA;AAEnC,MAAM,QAAQ,GAAG,CAAC,UAAkB,EAAE,EAAE;IACtC,IAAI,CAAC;QACH,OAAO,YAAY,CAAC,UAAU,CAAC,CAAA;IACjC,CAAC;IAAC,MAAM,CAAC,CAAA,CAAC;AACZ,CAAC,CAAA;AAED,MAAM,CAAC,MAAM,iBAAiB,GAAG,CAC/B,SAAiB,EACjB,IAAY,EACZ,EAAE;IACF,MAAM,QAAQ,GAAG,OAAO,CAAC,SAAS,EAAE,cAAc,CAAC,CAAA;IACnD,MAAM,UAAU,GAAG,OAAO,CAAC,QAAQ,EAAE,aAAa,CAAC,CAAA;IACnD,MAAM,MAAM,GAAG,QAAQ,CAAC,UAAU,CAAC,CAAA;IACnC,IAAI,MAAM,KAAK,IAAI,EAAE,CAAC;QACpB,UAAU,CAAC,UAAU,CAAC,CAAA;QACtB,UAAU,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAA;QAC/B,WAAW,CAAC,IAAI,EAAE,UAAU,CAAC,CAAA;IAC/B,CAAC;AACH,CAAC,CAAA","sourcesContent":["/**\n * create a symlink from our @tapjs/core into the plugin dir's node_modules\n */\n\nimport { readlinkSync, symlinkSync } from 'fs'\nimport { mkdirpSync } from 'mkdirp'\nimport { dirname, resolve } from 'path'\nimport { rimrafSync } from 'rimraf'\n\nconst readLink = (pluginCore: string) => {\n  try {\n    return readlinkSync(pluginCore)\n  } catch {}\n}\n\nexport const setPluginCoreLink = (\n  pluginDir: string,\n  core: string,\n) => {\n  const pluginNM = resolve(pluginDir, 'node_modules')\n  const pluginCore = resolve(pluginNM, '@tapjs/core')\n  const target = readLink(pluginCore)\n  if (target !== core) {\n    rimrafSync(pluginCore)\n    mkdirpSync(dirname(pluginCore))\n    symlinkSync(core, pluginCore)\n  }\n}\n"]}